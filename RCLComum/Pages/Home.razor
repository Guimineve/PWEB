@page "/"
@using RCLComum.DTOs
@using RCLComum.Services
@using RCLComum.Pages
@using RCLComum.Interfaces

@inject IApiServices ApiServices

<div class="home-fullscreen" style="display: flex; flex-direction: column; min-height: 100vh;">

    <div class="container-fluid pt-3">

        <CategoriasCarousel OnCategoriaSelecionada="FiltrarProdutos" />

        <hr class="mx-3 text-muted" />

        <div class="py-3">
            <CardCarousel CategoriaIdFiltro="@categoriaSelecionada" />
        </div>

        <div class="mt-5 pb-5">
            <h5 class="mb-3 px-3 border-start border-4 border-success">3. Sugestão para ti</h5>
            <SlideProdutoComponent ProdutoDestaque="@Destaque" />
        </div>

    </div>
</div>

@code {
    private int categoriaSelecionada = 0;
    private Produto? Destaque { get; set; }

    private void FiltrarProdutos(int idCategoria)
    {
        categoriaSelecionada = idCategoria;
        StateHasChanged();
    }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var result = await ApiServices.GetProdutosAsync();
            if (result.Sucesso && result.Data != null && result.Data.Any())
            {
                var rnd = new Random();
                Destaque = result.Data[rnd.Next(result.Data.Count)];
            }
        }
        catch
        {
            // Ignora erro no destaque para não bloquear a página
        }
    }
}