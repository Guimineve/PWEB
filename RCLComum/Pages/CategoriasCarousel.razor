@using RCLComum.DTOs
@using RCLComum.Services
@using RCLComum.Interfaces
@using Microsoft.AspNetCore.Components
@inject IApiServices ApiServices

<div class="py-3 mb-2">
    <h5 class="px-3 border-start border-4 border-warning">1. Filtrar por Categoria</h5>

    @if (Categorias == null)
    {
        <p class="px-3 text-muted">A carregar categorias...</p>
    }
    else
    {
        <div class="d-flex gap-2 px-3 overflow-auto" style="padding-bottom: 10px;">
            <button class="btn @(CategoriaSelecionadaId == 0 ? "btn-dark" : "btn-outline-dark") rounded-pill text-nowrap"
                    @onclick="() => Selecionar(0)">
                Todas
            </button>

            @foreach (var cat in Categorias)
            {
                <button class="btn @(CategoriaSelecionadaId == cat.Id ? "btn-warning" : "btn-outline-secondary") rounded-pill text-nowrap"
                        @onclick="() => Selecionar(cat.Id)">
                    @cat.Nome
                </button>
            }
        </div>
    }
</div>

@code {
    [Parameter] public EventCallback<int> OnCategoriaSelecionada { get; set; }

    private List<Categoria>? Categorias { get; set; }
    private int CategoriaSelecionadaId { get; set; } = 0;

    protected override async Task OnInitializedAsync()
    {
        var result = await ApiServices.GetCategoriasAsync();
        if (result.Sucesso)
        {
            Categorias = result.Data;
        }
    }

    private async Task Selecionar(int id)
    {
        CategoriaSelecionadaId = id;
        // Avisa o pai (Home)
        await OnCategoriaSelecionada.InvokeAsync(id);
    }
}